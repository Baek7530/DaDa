<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025ë…„ ìƒë°˜ê¸° ì›”ê°„ ì¹´í˜ìš´ì˜ë³´ê³ ì„œ</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <!-- Inter Font -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        .report-card {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="p-4 sm:p-8">

<div id="app" class="max-w-7xl mx-auto">
    <!-- Header -->
    <header class="text-center py-6 mb-8 rounded-xl bg-white shadow-md">
        <h1 class="text-3xl sm:text-4xl font-extrabold text-gray-800 tracking-tight">â˜• 2025ë…„ ìƒë°˜ê¸° ì¹´í˜ ìš´ì˜ ë³´ê³ ì„œ</h1>
        <p class="text-lg text-gray-500 mt-2">2025ë…„ 1ì›” ~ 2025ë…„ 6ì›” ì›”ë³„ ì„±ê³¼ ë¶„ì„</p>
    </header>

    <!-- Key Metrics Summary -->
    <div id="summary-section" class="mb-12">
        <h2 class="text-2xl font-bold text-gray-700 mb-6 border-b pb-2">ğŸ“Š í•µì‹¬ ì„±ê³¼ ì§€í‘œ ìš”ì•½</h2>
        <div id="key-metrics-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <!-- Metrics will be dynamically inserted here -->
        </div>
    </div>

    <!-- Data Table -->
    <div class="mb-12 report-card bg-white p-6 rounded-xl">
        <h2 class="text-2xl font-bold text-gray-700 mb-4 border-b pb-2">ğŸ“‘ ì›”ë³„ ìƒì„¸ ë°ì´í„°</h2>
        <div class="overflow-x-auto">
            <table id="report-table" class="min-w-full divide-y divide-gray-200">
                <thead class="bg-indigo-50">
                    <tr>
                        <th class="px-3 py-3 text-left text-xs font-medium text-indigo-600 uppercase tracking-wider">ì›”</th>
                        <th class="px-3 py-3 text-right text-xs font-medium text-indigo-600 uppercase tracking-wider">ë§¤ì¶œ(ë§Œì›)</th>
                        <th class="px-3 py-3 text-right text-xs font-medium text-indigo-600 uppercase tracking-wider">ìˆœì´ìµ(ë§Œì›)</th>
                        <th class="px-3 py-3 text-right text-xs font-medium text-indigo-600 uppercase tracking-wider">ìˆœì´ìµë¥ (%)</th>
                        <th class="px-3 py-3 text-right text-xs font-medium text-indigo-600 uppercase tracking-wider">ê³ ê°ìˆ˜(ëª…)</th>
                        <th class="px-3 py-3 text-right text-xs font-medium text-indigo-600 uppercase tracking-wider">ê°ë‹¨ê°€(ì›)</th>
                        <th class="px-3 py-3 text-right text-xs font-medium text-indigo-600 uppercase tracking-wider">ROI(%)</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    <!-- Table rows will be dynamically inserted here -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Charts Section -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Chart 1: Revenue & Profit -->
        <div class="report-card bg-white p-6 rounded-xl">
            <h3 class="text-xl font-semibold text-gray-700 mb-4">ë§¤ì¶œ ë° ìˆœì´ìµ ì¶”ì´ (ë§Œì›)</h3>
            <canvas id="revenueProfitChart"></canvas>
        </div>
        <!-- Chart 2: Profit Margin -->
        <div class="report-card bg-white p-6 rounded-xl">
            <h3 class="text-xl font-semibold text-gray-700 mb-4">ì›”ë³„ ìˆœì´ìµë¥  (%)</h3>
            <canvas id="profitMarginChart"></canvas>
        </div>
        <!-- Chart 3: Customers vs. AOV -->
        <div class="report-card bg-white p-6 rounded-xl lg:col-span-2">
            <h3 class="text-xl font-semibold text-gray-700 mb-4">ê³ ê°ìˆ˜ vs. ê°ë‹¨ê°€ ë¹„êµ</h3>
            <canvas id="customerAOVChart"></canvas>
        </div>
    </div>

</div>

<script>
    // CSV ë°ì´í„° (ì—…ë¡œë“œëœ íŒŒì¼ ë‚´ìš© ê¸°ë°˜)
    const csvDataString = `ì›”,ë§¤ì¶œ(ë§Œì›),ìˆœì´ìµ(ë§Œì›),ë§¤ì¶œ ì¦ê°ë¥ (%),ìˆœì´ìµ ì¦ê°ë¥ (%),ê³ ê°ìˆ˜(ëª…),ê°ë‹¨ê°€(ì›),ê³ ì •ë¹„(ë§Œì›),ë³€ë™ë¹„(ë§Œì›),ìˆœì´ìµë¥ (%),ê´‘ê³ ë¹„(ë§Œì›),ROI(%)
2020-01,1360,119,0.0,0.0,195,69743,500,576,8.75,100,119.0
2020-02,4272,451,214.12,278.99,763,55989,716,2102,10.56,78,578.21
2020-03,3592,682,-15.92,51.22,762,47139,511,1585,18.99,345,197.68
2020-04,966,211,-73.11,-69.06,289,33425,760,456,21.84,346,60.98
2020-05,4926,1089,409.94,416.11,835,58994,519,2466,22.11,263,414.07
2025-01,3719,436,475.7,289.29,507,73353,494,1622,11.72,435,100.23
2025-02,3411,617,-8.28,41.51,767,44471,651,1984,18.09,244,252.87
2025-03,2234,283,-34.51,-54.13,472,47330,494,1154,12.67,168,168.45
2025-04,3740,664,67.41,134.63,647,57805,609,1792,17.75,393,168.96
2025-05,4920,520,31.55,-21.69,755,65166,623,3117,10.57,177,293.79
2025-06,3583,751,-27.2,44.42,425,84306,511,1867,20.96,135,556.3`;

    // ìš”ì²­ëœ ê¸°ê°„ ì„¤ì •
    const START_MONTH = '2025-01';
    const END_MONTH = '2025-06';
    const YEAR_TO_DISPLAY = '2025'; // í‘œì‹œí•  ì—°ë„

    /**
     * CSV ë¬¸ìì—´ì„ íŒŒì‹±í•˜ê³  ì§€ì •ëœ ê¸°ê°„ì˜ ë°ì´í„°ë§Œ í•„í„°ë§í•©ë‹ˆë‹¤.
     * @param {string} csvText CSV ì›ë³¸ ë¬¸ìì—´
     * @param {string} startMonth ì‹œì‘ ì›” (YYYY-MM)
     * @param {string} endMonth ì¢…ë£Œ ì›” (YYYY-MM)
     * @returns {Array<Object>} í•„í„°ë§ëœ ë°ì´í„° ê°ì²´ ë°°ì—´
     */
    function parseAndFilterCSV(csvText, startMonth, endMonth) {
        const lines = csvText.trim().split('\n');
        const headers = lines[0].split(',');
        const data = [];

        for (let i = 1; i < lines.length; i++) {
            const values = lines[i].split(',');
            if (values.length === headers.length) {
                const item = {};
                headers.forEach((header, index) => {
                    // ìˆ«ìí˜• ë°ì´í„°ëŠ” Numberë¡œ ë³€í™˜
                    const value = values[index];
                    item[header.trim()] = isNaN(value) || header.trim() === 'ì›”' ? value.trim() : Number(value.trim());
                });

                // í•„í„°ë§: ìš”ì²­ ê¸°ê°„ ë‚´ì˜ ë°ì´í„°ë§Œ í¬í•¨ (2035ë…„ ë°ì´í„°ë„ 2025ë…„ìœ¼ë¡œ ê°„ì£¼í•˜ì—¬ ì²˜ë¦¬)
                const month = item['ì›”'];
                if (month >= startMonth && month <= endMonth) {
                    // í‘œì‹œ ì—°ë„ë¥¼ 2025ë…„ìœ¼ë¡œ ê°•ì œ ë³€ê²½
                    item['ì›”_í‘œì‹œ'] = item['ì›”'].replace(/^\d{4}/, YEAR_TO_DISPLAY);
                    data.push(item);
                }
            }
        }
        return data;
    }

    /**
     * ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ í•µì‹¬ ìš”ì•½ ì§€í‘œë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
     * @param {Array<Object>} data í•„í„°ë§ëœ ë°ì´í„°
     * @returns {Object} í•µì‹¬ ì§€í‘œ ìš”ì•½ ê°ì²´
     */
    function calculateSummary(data) {
        const totalRevenue = data.reduce((sum, item) => sum + item['ë§¤ì¶œ(ë§Œì›)'], 0);
        const totalProfit = data.reduce((sum, item) => sum + item['ìˆœì´ìµ(ë§Œì›)'], 0);
        const totalCustomers = data.reduce((sum, item) => sum + item['ê³ ê°ìˆ˜(ëª…)'], 0);
        const avgProfitMargin = totalRevenue > 0 ? (totalProfit / totalRevenue) * 100 : 0;
        const avgAOV = totalCustomers > 0 ? (totalRevenue * 10000 / totalCustomers) : 0; // ë§¤ì¶œ(ë§Œì›) * 10000 / ê³ ê°ìˆ˜

        // 6ì›” ë°ì´í„° (ìµœì‹  ë™í–¥)
        const latest = data[data.length - 1];

        return {
            totalRevenue: totalRevenue.toFixed(0),
            totalProfit: totalProfit.toFixed(0),
            totalCustomers: totalCustomers.toFixed(0),
            avgProfitMargin: avgProfitMargin.toFixed(2),
            latestProfitMargin: latest ? latest['ìˆœì´ìµë¥ (%)'].toFixed(2) : 'N/A',
            latestAOV: latest ? latest['ê°ë‹¨ê°€(ì›)'].toLocaleString() : 'N/A',
        };
    }

    /**
     * HTML í…Œì´ë¸”ì— ë°ì´í„°ë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤.
     * @param {Array<Object>} data í•„í„°ë§ëœ ë°ì´í„°
     */
    function renderTable(data) {
        const tbody = document.querySelector('#report-table tbody');
        if (!tbody) return;
        tbody.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

        data.forEach((item, index) => {
            const row = tbody.insertRow();
            row.className = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';

            const cells = [
                item['ì›”_í‘œì‹œ'],
                item['ë§¤ì¶œ(ë§Œì›)'].toLocaleString(),
                item['ìˆœì´ìµ(ë§Œì›)'].toLocaleString(),
                `${item['ìˆœì´ìµë¥ (%)'].toFixed(2)}%`,
                item['ê³ ê°ìˆ˜(ëª…)'].toLocaleString(),
                item['ê°ë‹¨ê°€(ì›)'].toLocaleString(),
                `${item['ROI(%)'].toFixed(2)}%`,
            ];

            cells.forEach((text, i) => {
                const cell = row.insertCell();
                cell.className = `px-3 py-4 whitespace-nowrap text-sm ${i === 0 ? 'text-gray-900 font-medium' : 'text-gray-500 text-right'}`;

                // ìˆœì´ìµë¥  í•˜ì´ë¼ì´íŠ¸ (ìµœëŒ€ê°’)
                if (i === 3 && item['ìˆœì´ìµë¥ (%)'] === Math.max(...data.map(d => d['ìˆœì´ìµë¥ (%)']))) {
                    cell.classList.add('font-bold', 'text-red-600');
                }
                // ROI í•˜ì´ë¼ì´íŠ¸ (ìµœëŒ€ê°’)
                if (i === 6 && item['ROI(%)'] === Math.max(...data.map(d => d['ROI(%)']))) {
                    cell.classList.add('font-bold', 'text-green-600');
                }

                cell.textContent = text;
            });
        });
    }

    /**
     * í•µì‹¬ ìš”ì•½ ì§€í‘œ ì¹´ë“œë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤.
     * @param {Object} summary ìš”ì•½ ë°ì´í„°
     */
    function renderKeyMetrics(summary) {
        const container = document.getElementById('key-metrics-container');
        if (!container) return;

        const metrics = [
            {
                title: 'ìƒë°˜ê¸° ì´ ë§¤ì¶œ',
                value: `${summary.totalRevenue} ë§Œì›`,
                icon: 'ğŸ“ˆ',
                color: 'bg-blue-500',
            },
            {
                title: 'ìƒë°˜ê¸° ì´ ìˆœì´ìµ',
                value: `${summary.totalProfit} ë§Œì›`,
                icon: 'ğŸ’°',
                color: 'bg-green-500',
            },
            {
                title: 'í‰ê·  ìˆœì´ìµë¥ ',
                value: `${summary.avgProfitMargin}%`,
                icon: 'ğŸ’²',
                color: 'bg-yellow-500',
            },
            {
                title: 'ì´ ë°©ë¬¸ ê³ ê°ìˆ˜',
                value: `${summary.totalCustomers} ëª…`,
                icon: 'ğŸ‘¥',
                color: 'bg-purple-500',
            },
        ];

        container.innerHTML = metrics.map(metric => `
            <div class="report-card ${metric.color} text-white p-5 rounded-xl flex items-center space-x-4">
                <div class="text-3xl">${metric.icon}</div>
                <div>
                    <div class="text-sm opacity-80">${metric.title}</div>
                    <div class="text-2xl font-bold">${metric.value}</div>
                </div>
            </div>
        `).join('');
    }

    /**
     * Chart.jsë¥¼ ì‚¬ìš©í•˜ì—¬ ê·¸ë˜í”„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
     * @param {Array<Object>} data í•„í„°ë§ëœ ë°ì´í„°
     */
    function renderCharts(data) {
        const labels = data.map(item => item['ì›”_í‘œì‹œ'].replace('2025-', '')); // ì°¨íŠ¸ ë¼ë²¨ (ì˜ˆ: 01, 02)

        // ----------------- ì°¨íŠ¸ 1: ë§¤ì¶œ ë° ìˆœì´ìµ ì¶”ì´ (ì´ì¤‘ ì¶•) -----------------
        new Chart(document.getElementById('revenueProfitChart'), {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'ë§¤ì¶œ(ë§Œì›)',
                        data: data.map(item => item['ë§¤ì¶œ(ë§Œì›)']),
                        borderColor: '#3b82f6', // blue-500
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        yAxisID: 'y1',
                        fill: true,
                        tension: 0.3,
                    },
                    {
                        label: 'ìˆœì´ìµ(ë§Œì›)',
                        data: data.map(item => item['ìˆœì´ìµ(ë§Œì›)']),
                        borderColor: '#10b981', // emerald-500
                        backgroundColor: 'rgba(16, 185, 129, 0.8)',
                        yAxisID: 'y2',
                        tension: 0.3,
                        pointRadius: 5,
                        pointHoverRadius: 7,
                    }
                ]
            },
            options: {
                responsive: true,
                interaction: { mode: 'index', intersect: false, },
                scales: {
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        title: { display: true, text: 'ë§¤ì¶œ (ë§Œì›)' }
                    },
                    y2: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        grid: { drawOnChartArea: false }, // ì˜¤ë¥¸ìª½ ì¶• ëˆˆê¸ˆì„  ì œê±°
                        title: { display: true, text: 'ìˆœì´ìµ (ë§Œì›)' }
                    }
                },
            }
        });

        // ----------------- ì°¨íŠ¸ 2: ì›”ë³„ ìˆœì´ìµë¥  (%) (ë§‰ëŒ€) -----------------
        new Chart(document.getElementById('profitMarginChart'), {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'ìˆœì´ìµë¥  (%)',
                        data: data.map(item => item['ìˆœì´ìµë¥ (%)']),
                        backgroundColor: (context) => {
                            const value = context.dataset.data[context.dataIndex];
                            return value > 15 ? '#ef4444' : '#f59e0b'; // red-500 or amber-500
                        },
                        borderColor: '#4b5563',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: { display: true, text: 'ìˆœì´ìµë¥  (%)' }
                    }
                }
            }
        });

        // ----------------- ì°¨íŠ¸ 3: ê³ ê°ìˆ˜ vs. ê°ë‹¨ê°€ ë¹„êµ (í˜¼í•©) -----------------
        new Chart(document.getElementById('customerAOVChart'), {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'ê³ ê°ìˆ˜ (ëª…)',
                        data: data.map(item => item['ê³ ê°ìˆ˜(ëª…)']),
                        backgroundColor: '#a855f7', // violet-500
                        yAxisID: 'y1',
                    },
                    {
                        label: 'ê°ë‹¨ê°€ (ì›)',
                        data: data.map(item => item['ê°ë‹¨ê°€(ì›)']),
                        type: 'line',
                        borderColor: '#22d3ee', // cyan-500
                        backgroundColor: 'transparent',
                        yAxisID: 'y2',
                        tension: 0.4,
                    }
                ]
            },
            options: {
                responsive: true,
                interaction: { mode: 'index', intersect: false, },
                scales: {
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        title: { display: true, text: 'ê³ ê°ìˆ˜ (ëª…)' }
                    },
                    y2: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        grid: { drawOnChartArea: false },
                        title: { display: true, text: 'ê°ë‹¨ê°€ (ì›)' }
                    }
                },
            }
        });
    }

    // ì´ˆê¸°í™” í•¨ìˆ˜
    function initializeReport() {
        try {
            const filteredData = parseAndFilterCSV(csvDataString, START_MONTH, END_MONTH);
            const summary = calculateSummary(filteredData);

            renderKeyMetrics(summary);
            renderTable(filteredData);
            renderCharts(filteredData);

        } catch (error) {
            console.error("ë³´ê³ ì„œë¥¼ ìƒì„±í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:", error);
            document.getElementById('app').innerHTML = '<div class="text-center text-red-500 p-10">ë°ì´í„° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.</div>';
        }
    }

    window.onload = initializeReport;

</script>
</body>
</html>
